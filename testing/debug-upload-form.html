<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="test-token">
    <title>Debug Upload Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body>
    <div class="container mt-5">
        <div class="card">
            <div class="card-header">
                <h4>Debug Upload Form - Exact Copy from Laravel</h4>
            </div>
            <div class="card-body">
                <form action="#" method="POST" enctype="multipart/form-data">
                    <!-- Version Name -->
                    <div class="mb-3">
                        <label for="version_name" class="form-label">Version Name <span class="text-danger">*</span></label>
                        <input type="text" 
                               class="form-control" 
                               id="version_name" 
                               name="version_name" 
                               placeholder="e.g., 1.2.0"
                               required>
                    </div>

                    <!-- Version Code -->
                    <div class="mb-3">
                        <label for="version_code" class="form-label">Version Code <span class="text-danger">*</span></label>
                        <input type="number" 
                               class="form-control" 
                               id="version_code" 
                               name="version_code" 
                               placeholder="e.g., 3"
                               min="1"
                               required>
                    </div>

                    <!-- Release Notes -->
                    <div class="mb-3">
                        <label for="release_notes" class="form-label">Release Notes</label>
                        <textarea class="form-control" 
                                  id="release_notes" 
                                  name="release_notes" 
                                  rows="5"
                                  placeholder="What's new in this version?"></textarea>
                    </div>

                    <!-- APK File -->
                    <div class="mb-3">
                        <label for="apk_file" class="form-label">APK File <span class="text-danger">*</span></label>
                        <input type="file" 
                               class="form-control" 
                               id="apk_file" 
                               name="apk_file" 
                               accept=".apk"
                               required>
                        <small class="form-text text-muted">Upload APK file (maximum 150MB)</small>
                        
                        <!-- File Info Display -->
                        <div id="file-info" class="mt-2 d-none">
                            <small class="text-muted">
                                <i class="bi bi-file-earmark-zip"></i> 
                                <span id="file-name"></span> 
                                (<span id="file-size"></span>)
                            </small>
                        </div>
                    </div>

                    <!-- Upload Progress Bar -->
                    <div id="upload-progress-container" class="mb-3 d-none">
                        <div class="card border-primary">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="fw-bold">Uploading...</span>
                                    <span id="progress-percentage" class="badge bg-primary">0%</span>
                                </div>
                                <div class="progress" style="height: 25px;">
                                    <div id="progress-bar" 
                                         class="progress-bar progress-bar-striped progress-bar-animated" 
                                         role="progressbar" 
                                         style="width: 0%"
                                         aria-valuenow="0" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100">
                                        <span id="progress-text">0%</span>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <small class="text-muted">
                                        <span id="upload-speed">0 KB/s</span> ‚Ä¢ 
                                        <span id="upload-eta">Calculating...</span>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="d-flex justify-content-end gap-2">
                        <button type="button" class="btn btn-secondary" id="cancel-btn">
                            <i class="bi bi-x-circle"></i> Cancel
                        </button>
                        <button type="submit" class="btn btn-primary" id="upload-btn">
                            <i class="bi bi-upload"></i> Upload
                        </button>
                    </div>
                </form>

                <!-- Console Log Display -->
                <div class="mt-4">
                    <h5>Console Logs:</h5>
                    <div id="console-log" class="border p-3" style="background: #f8f9fa; max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 12px;">
                        <div>Waiting for actions...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    // Custom console log to display on page
    const consoleLog = document.getElementById('console-log');
    function log(message, data = null) {
        const time = new Date().toLocaleTimeString();
        const logEntry = document.createElement('div');
        logEntry.style.marginBottom = '5px';
        logEntry.innerHTML = `<strong>[${time}]</strong> ${message}`;
        if (data) {
            logEntry.innerHTML += ` <span style="color: blue;">${JSON.stringify(data)}</span>`;
        }
        consoleLog.appendChild(logEntry);
        consoleLog.scrollTop = consoleLog.scrollHeight;
        console.log(message, data);
    }

    document.addEventListener('DOMContentLoaded', function() {
        log('‚úÖ Upload progress script loaded');
        
        const form = document.querySelector('form');
        const fileInput = document.getElementById('apk_file');
        const uploadBtn = document.getElementById('upload-btn');
        const cancelBtn = document.getElementById('cancel-btn');
        const progressContainer = document.getElementById('upload-progress-container');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const progressPercentage = document.getElementById('progress-percentage');
        const uploadSpeed = document.getElementById('upload-speed');
        const uploadEta = document.getElementById('upload-eta');
        const fileInfo = document.getElementById('file-info');
        const fileName = document.getElementById('file-name');
        const fileSize = document.getElementById('file-size');

        log('‚úÖ Elements found:', {
            form: !!form,
            fileInput: !!fileInput,
            uploadBtn: !!uploadBtn,
            progressContainer: !!progressContainer
        });

        let startTime;

        // Show file info when file is selected
        fileInput.addEventListener('change', function(e) {
            log('üìÅ File selected:', this.files.length);
            if (this.files.length > 0) {
                const file = this.files[0];
                log('üìÑ File info:', { name: file.name, size: file.size });
                fileName.textContent = file.name;
                fileSize.textContent = formatFileSize(file.size);
                fileInfo.classList.remove('d-none');
            } else {
                fileInfo.classList.add('d-none');
            }
        });

        // Handle form submission with progress tracking
        form.addEventListener('submit', function(e) {
            log('üöÄ Form submitted');
            e.preventDefault();

            // Validate form
            if (!form.checkValidity()) {
                log('‚ùå Form validation failed');
                form.classList.add('was-validated');
                return;
            }

            log('‚úÖ Starting simulated upload...');
            
            // Show progress bar and disable buttons
            progressContainer.classList.remove('d-none');
            uploadBtn.disabled = true;
            cancelBtn.disabled = true;
            fileInput.disabled = true;

            // Simulate upload
            simulateUpload();
        });

        function simulateUpload() {
            const file = fileInput.files[0];
            const totalSize = file.size;
            const duration = 10000; // 10 seconds
            startTime = Date.now();
            
            log('‚è±Ô∏è Simulating upload for 10 seconds...');

            const interval = setInterval(function() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min((elapsed / duration) * 100, 100);
                const loaded = (progress / 100) * totalSize;
                
                // Update progress bar
                progressBar.style.width = progress + '%';
                progressBar.setAttribute('aria-valuenow', progress);
                progressText.textContent = Math.round(progress) + '%';
                progressPercentage.textContent = Math.round(progress) + '%';

                // Calculate speed
                const speed = loaded / (elapsed / 1000);
                uploadSpeed.textContent = formatFileSize(speed) + '/s';

                // Calculate ETA
                const remaining = totalSize - loaded;
                const eta = remaining / speed;
                uploadEta.textContent = 'ETA: ' + formatTime(eta);

                // Change color
                if (progress < 50) {
                    progressBar.className = 'progress-bar progress-bar-striped progress-bar-animated bg-primary';
                } else if (progress < 90) {
                    progressBar.className = 'progress-bar progress-bar-striped progress-bar-animated bg-warning';
                } else {
                    progressBar.className = 'progress-bar progress-bar-striped progress-bar-animated bg-success';
                }

                if (progress >= 100) {
                    clearInterval(interval);
                    progressBar.classList.remove('progress-bar-animated');
                    progressText.textContent = 'Complete!';
                    uploadSpeed.textContent = 'Completed';
                    uploadEta.textContent = 'Done!';
                    log('‚úÖ Upload simulation complete!');
                    
                    setTimeout(function() {
                        alert('Upload complete! (This is a simulation)');
                    }, 500);
                }
            }, 100);
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];
        }

        function formatTime(seconds) {
            if (isNaN(seconds) || seconds === Infinity) return 'Calculating...';
            if (seconds < 60) {
                return Math.round(seconds) + 's';
            } else if (seconds < 3600) {
                const minutes = Math.floor(seconds / 60);
                const secs = Math.round(seconds % 60);
                return minutes + 'm ' + secs + 's';
            } else {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                return hours + 'h ' + minutes + 'm';
            }
        }
    });
    </script>
</body>
</html>
