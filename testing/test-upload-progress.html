<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Upload Progress</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h4 class="mb-0">Test Upload Progress Feature</h4>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i>
                            <strong>Demo Mode:</strong> File ini untuk testing UI upload progress tanpa backend.
                            Progress akan simulasi upload selama 10 detik.
                        </div>

                        <form id="test-form">
                            <div class="mb-3">
                                <label for="test_file" class="form-label">Pilih File APK</label>
                                <input type="file" class="form-control" id="test_file" accept=".apk" required>
                                
                                <div id="file-info" class="mt-2 d-none">
                                    <small class="text-muted">
                                        <i class="bi bi-file-earmark-zip"></i> 
                                        <span id="file-name"></span> 
                                        (<span id="file-size"></span>)
                                    </small>
                                </div>
                            </div>

                            <div id="upload-progress-container" class="mb-3 d-none">
                                <div class="card border-primary">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span class="fw-bold">Uploading...</span>
                                            <span id="progress-percentage" class="badge bg-primary">0%</span>
                                        </div>
                                        <div class="progress" style="height: 25px;">
                                            <div id="progress-bar" 
                                                 class="progress-bar progress-bar-striped progress-bar-animated" 
                                                 role="progressbar" 
                                                 style="width: 0%">
                                                <span id="progress-text">0%</span>
                                            </div>
                                        </div>
                                        <div class="mt-2">
                                            <small class="text-muted">
                                                <span id="upload-speed">0 KB/s</span> â€¢ 
                                                <span id="upload-eta">Calculating...</span>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary" id="upload-btn">
                                <i class="bi bi-upload"></i> Test Upload
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('test-form');
            const fileInput = document.getElementById('test_file');
            const uploadBtn = document.getElementById('upload-btn');
            const progressContainer = document.getElementById('upload-progress-container');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const progressPercentage = document.getElementById('progress-percentage');
            const uploadSpeed = document.getElementById('upload-speed');
            const uploadEta = document.getElementById('upload-eta');
            const fileInfo = document.getElementById('file-info');
            const fileName = document.getElementById('file-name');
            const fileSize = document.getElementById('file-size');

            fileInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    const file = this.files[0];
                    fileName.textContent = file.name;
                    fileSize.textContent = formatFileSize(file.size);
                    fileInfo.classList.remove('d-none');
                } else {
                    fileInfo.classList.add('d-none');
                }
            });

            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (!fileInput.files.length) {
                    alert('Please select a file');
                    return;
                }

                // Simulate upload
                simulateUpload();
            });

            function simulateUpload() {
                const file = fileInput.files[0];
                const totalSize = file.size;
                const duration = 10000; // 10 seconds
                const startTime = Date.now();
                
                progressContainer.classList.remove('d-none');
                uploadBtn.disabled = true;
                fileInput.disabled = true;

                const interval = setInterval(function() {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min((elapsed / duration) * 100, 100);
                    const loaded = (progress / 100) * totalSize;
                    
                    // Update progress bar
                    progressBar.style.width = progress + '%';
                    progressText.textContent = Math.round(progress) + '%';
                    progressPercentage.textContent = Math.round(progress) + '%';

                    // Calculate speed
                    const speed = loaded / (elapsed / 1000);
                    uploadSpeed.textContent = formatFileSize(speed) + '/s';

                    // Calculate ETA
                    const remaining = totalSize - loaded;
                    const eta = remaining / speed;
                    uploadEta.textContent = 'ETA: ' + formatTime(eta);

                    // Change color
                    if (progress < 50) {
                        progressBar.className = 'progress-bar progress-bar-striped progress-bar-animated bg-primary';
                    } else if (progress < 90) {
                        progressBar.className = 'progress-bar progress-bar-striped progress-bar-animated bg-warning';
                    } else {
                        progressBar.className = 'progress-bar progress-bar-striped progress-bar-animated bg-success';
                    }

                    if (progress >= 100) {
                        clearInterval(interval);
                        progressBar.classList.remove('progress-bar-animated');
                        progressText.textContent = 'Complete!';
                        uploadSpeed.textContent = 'Completed';
                        uploadEta.textContent = 'Done!';
                        
                        setTimeout(function() {
                            alert('Upload simulation complete!');
                            location.reload();
                        }, 1000);
                    }
                }, 100);
            }

            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];
            }

            function formatTime(seconds) {
                if (isNaN(seconds) || seconds === Infinity) return 'Calculating...';
                if (seconds < 60) {
                    return Math.round(seconds) + 's';
                } else if (seconds < 3600) {
                    const minutes = Math.floor(seconds / 60);
                    const secs = Math.round(seconds % 60);
                    return minutes + 'm ' + secs + 's';
                } else {
                    const hours = Math.floor(seconds / 3600);
                    const minutes = Math.floor((seconds % 3600) / 60);
                    return hours + 'h ' + minutes + 'm';
                }
            }
        });
    </script>
</body>
</html>
